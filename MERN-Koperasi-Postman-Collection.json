{
  "info": {
    "name": "MERN Koperasi API",
    "description": "API Collection for MERN Koperasi with Admin and Member endpoints",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{auth_token}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:5000",
      "type": "string"
    },
    {
      "key": "auth_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "created_member_uuid",
      "value": "",
      "type": "string"
    },
    {
      "key": "created_member_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "product_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "saving_id",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Admin API",
      "item": [
        {
          "name": "Authentication",
          "item": [
            {
              "name": "Admin Login",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "if (pm.response.code === 200) {",
                      "    var jsonData = pm.response.json();",
                      "    if (jsonData.success && jsonData.data.token) {",
                      "        pm.collectionVariables.set('auth_token', jsonData.data.token);",
                      "        console.log('Token saved:', jsonData.data.token.substring(0, 20) + '...');",
                      "    }",
                      "} else {",
                      "    console.log('Login failed:', pm.response.text());",
                      "}"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"username\": \"admin\",\n  \"password\": \"admin123\"\n}"
                },
                "url": {
                  "raw": "{{base_url}}/api/admin/auth/login",
                  "host": ["{{base_url}}"],
                  "path": ["api", "admin", "auth", "login"]
                }
              }
            },
            {
              "name": "Admin Register",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"username\": \"admin\",\n  \"password\": \"admin123\",\n  \"name\": \"Administrator\",\n  \"role\": \"admin\"\n}"
                },
                "url": {
                  "raw": "{{base_url}}/api/admin/auth/register",
                  "host": ["{{base_url}}"],
                  "path": ["api", "admin", "auth", "register"]
                }
              }
            },
            {
              "name": "Get Current Admin User",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/api/admin/auth/me",
                  "host": ["{{base_url}}"],
                  "path": ["api", "admin", "auth", "me"]
                }
              }
            },
            {
              "name": "Admin Logout",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/api/admin/auth/logout",
                  "host": ["{{base_url}}"],
                  "path": ["api", "admin", "auth", "logout"]
                }
              }
            }
          ]
        },
        {
          "name": "Members Management",
          "item": [
            {
              "name": "Get All Members",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/api/admin/members",
                  "host": ["{{base_url}}"],
                  "path": ["api", "admin", "members"]
                }
              }
            },
            {
              "name": "Get Member By UUID",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/api/admin/members/MEMBER_1234567890_ABCDE",
                  "host": ["{{base_url}}"],
                  "path": ["api", "admin", "members", "MEMBER_1234567890_ABCDE"],
                  "variable": [
                    {
                      "key": "uuid",
                      "value": "MEMBER_1234567890_ABCDE",
                      "description": "Member UUID"
                    }
                  ]
                }
              }
            },
            {
              "name": "Create Member",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "if (pm.response.code === 201) {",
                      "    var jsonData = pm.response.json();",
                      "    if (jsonData.success && jsonData.data.uuid) {",
                      "        pm.collectionVariables.set('created_member_uuid', jsonData.data.uuid);",
                      "        pm.collectionVariables.set('created_member_id', jsonData.data._id);",
                      "        console.log('Member created with UUID:', jsonData.data.uuid);",
                      "        console.log('Member created with ID:', jsonData.data._id);",
                      "    }",
                      "}"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{ \n  \"uuid\": \"MEMBER_1234567890_ABCDE\",\n  \"name\": \"John Doe\",\n  \"gender\": \"L\",\n  \"phone\": \"08123456789\",\n  \"city\": \"Jakarta\",\n  \"completeAddress\": \"Jl. Contoh No. 123\"\n}"
                },
                "url": {
                  "raw": "{{base_url}}/api/admin/members",
                  "host": ["{{base_url}}"],
                  "path": ["api", "admin", "members"]
                }
              }
            },
            {
              "name": "Update Member By UUID",
              "request": {
                "method": "PUT",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"name\": \"John Doe Updated\",\n  \"phone\": \"08123456780\",\n  \"city\": \"Bandung\"\n}"
                },
                "url": {
                  "raw": "{{base_url}}/api/admin/members/{{created_member_uuid}}",
                  "host": ["{{base_url}}"],
                  "path": ["api", "admin", "members", "{{created_member_uuid}}"]
                }
              }
            },
            {
              "name": "Delete Member By UUID",
              "request": {
                "method": "DELETE",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/api/admin/members/{{created_member_uuid}}",
                  "host": ["{{base_url}}"],
                  "path": ["api", "admin", "members", "{{created_member_uuid}}"]
                }
              }
            }
          ]
        },
        {
          "name": "Savings Management",
          "item": [
            {
              "name": "Get All Savings",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/api/admin/savings",
                  "host": ["{{base_url}}"],
                  "path": ["api", "admin", "savings"]
                }
              }
            },
            {
              "name": "Create Saving (Full Payment)",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "if (pm.response.code === 201) {",
                      "    var jsonData = pm.response.json();",
                      "    if (jsonData.success && jsonData.data._id) {",
                      "        pm.collectionVariables.set('saving_id', jsonData.data._id);",
                      "        console.log('Saving created with ID:', jsonData.data._id);",
                      "        console.log('Payment Type:', jsonData.data.paymentType);",
                      "    }",
                      "}"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"memberId\": \"{{created_member_id}}\",\n  \"productId\": \"{{product_id}}\",\n  \"amount\": 2500000,\n  \"installmentPeriod\": 1,\n  \"savingsDate\": \"2024-12-09\",\n  \"type\": \"Setoran\",\n  \"description\": \"Pembayaran Simpanan Periode - 1\",\n  \"status\": \"Pending\",\n  \"notes\": \"Pembayaran penuh periode 1\"\n}"
                },
                "url": {
                  "raw": "{{base_url}}/api/admin/savings",
                  "host": ["{{base_url}}"],
                  "path": ["api", "admin", "savings"]
                }
              }
            },
            {
              "name": "Create Saving (Partial Payment)",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"memberId\": \"{{created_member_id}}\",\n  \"productId\": \"{{product_id}}\",\n  \"amount\": 1000000,\n  \"installmentPeriod\": 1,\n  \"savingsDate\": \"2024-12-09\",\n  \"type\": \"Setoran\",\n  \"description\": \"Pembayaran Partial Periode - 1\",\n  \"status\": \"Pending\",\n  \"notes\": \"Pembayaran sebagian periode 1\"\n}"
                },
                "url": {
                  "raw": "{{base_url}}/api/admin/savings",
                  "host": ["{{base_url}}"],
                  "path": ["api", "admin", "savings"]
                }
              }
            },
            {
              "name": "Approve Saving",
              "request": {
                "method": "PATCH",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"notes\": \"Approved by admin - payment verified\"\n}"
                },
                "url": {
                  "raw": "{{base_url}}/api/admin/savings/{{saving_id}}/approve",
                  "host": ["{{base_url}}"],
                  "path": ["api", "admin", "savings", "{{saving_id}}", "approve"]
                }
              }
            },
            {
              "name": "Reject Saving",
              "request": {
                "method": "PATCH",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"rejectionReason\": \"Bukti pembayaran tidak valid\",\n  \"notes\": \"Mohon upload ulang bukti yang lebih jelas\"\n}"
                },
                "url": {
                  "raw": "{{base_url}}/api/admin/savings/{{saving_id}}/reject",
                  "host": ["{{base_url}}"],
                  "path": ["api", "admin", "savings", "{{saving_id}}", "reject"]
                }
              }
            },
            {
              "name": "Get Period Summary",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/api/admin/savings/period-summary/{{created_member_id}}/{{product_id}}/1",
                  "host": ["{{base_url}}"],
                  "path": ["api", "admin", "savings", "period-summary", "{{created_member_id}}", "{{product_id}}", "1"]
                }
              }
            },
            {
              "name": "Check Period Info",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/api/admin/savings/check-period/{{created_member_id}}/{{product_id}}",
                  "host": ["{{base_url}}"],
                  "path": ["api", "admin", "savings", "check-period", "{{created_member_id}}", "{{product_id}}"]
                }
              }
            },
            {
              "name": "Get Savings with Filters",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/api/admin/savings?memberId={{created_member_id}}&productId={{product_id}}&status=Rejected",
                  "host": ["{{base_url}}"],
                  "path": ["api", "admin", "savings"],
                  "query": [
                    {
                      "key": "memberId",
                      "value": "{{created_member_id}}"
                    },
                    {
                      "key": "productId", 
                      "value": "{{product_id}}"
                    },
                    {
                      "key": "status",
                      "value": "Rejected"
                    }
                  ]
                }
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Member API",
      "item": [
        {
          "name": "Authentication",
          "item": [
            {
              "name": "Member Login",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "if (pm.response.code === 200) {",
                      "    var jsonData = pm.response.json();",
                      "    if (jsonData.success && jsonData.data.token) {",
                      "        pm.collectionVariables.set('auth_token', jsonData.data.token);",
                      "        console.log('Member token saved:', jsonData.data.token.substring(0, 20) + '...');",
                      "    }",
                      "} else {",
                      "    console.log('Member login failed:', pm.response.text());",
                      "}"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"uuid\": \"MEMBER_1234567890_ABCDE\",\n  \"password\": \"MEMBER_1234567890_ABCDE-1234\"\n}"
                },
                "url": {
                  "raw": "{{base_url}}/api/member/auth/login",
                  "host": ["{{base_url}}"],
                  "path": ["api", "member", "auth", "login"]
                }
              }
            },
            {
              "name": "Get Current Member",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/api/member/auth/me",
                  "host": ["{{base_url}}"],
                  "path": ["api", "member", "auth", "me"]
                }
              }
            },
            {
              "name": "Member Logout",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/api/member/auth/logout",
                  "host": ["{{base_url}}"],
                  "path": ["api", "member", "auth", "logout"]
                }
              }
            }
          ]
        },
        {
          "name": "Savings",
          "item": [
            {
              "name": "Get My Savings",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/api/member/savings",
                  "host": ["{{base_url}}"],
                  "path": ["api", "member", "savings"]
                }
              }
            },
            {
              "name": "Create My Saving (Full)",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"amount\": 2500000,\n  \"description\": \"Pembayaran Simpanan Periode - 1\",\n  \"installmentPeriod\": 1,\n  \"notes\": \"Pembayaran penuh via member API\"\n}"
                },
                "url": {
                  "raw": "{{base_url}}/api/member/savings",
                  "host": ["{{base_url}}"],
                  "path": ["api", "member", "savings"]
                }
              }
            },
            {
              "name": "Create My Saving (Partial)",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"amount\": 1000000,\n  \"description\": \"Pembayaran Partial Periode - 1\",\n  \"installmentPeriod\": 1,\n  \"notes\": \"Pembayaran sebagian via member API\"\n}"
                },
                "url": {
                  "raw": "{{base_url}}/api/member/savings",
                  "host": ["{{base_url}}"],
                  "path": ["api", "member", "savings"]
                }
              }
            },
            {
              "name": "Get My Savings Summary",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/api/member/savings/summary",
                  "host": ["{{base_url}}"],
                  "path": ["api", "member", "savings", "summary"]
                }
              }
            },
            {
              "name": "Get My Saving By ID",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{auth_token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/api/member/savings/:id",
                  "host": ["{{base_url}}"],
                  "path": ["api", "member", "savings", ":id"]
                }
              }
            }
          ]
        }
      ]
    }
  ]
}